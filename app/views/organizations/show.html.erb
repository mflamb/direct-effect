<% if current_admin || current_user %>

<p>
  <strong>Name:</strong>
  <%= @organization.name %>
</p>

<p>
  <strong>Description:</strong>
  <%= @organization.description %>
</p>

<p>
  <strong>Address:</strong>
  <%= link_to @organization.address,
  "https://www.google.com/maps/dir/?api=1&destination=#{@organization.address.to_param}",
  target: '_blank'
  %>
</p>

<p>
  <strong>Website:</strong>
  <%= link_to @organization.website.sub(/^https?\:\/\/(www.)?/, ''),
  @organization.website,
  target: '_blank' %>
</p>

<p>
  <strong>Point of Contact:</strong>
  <%= @organization.poc_name %>
</p>

<p>
  <strong>Email:</strong>
  <%= @organization.email %>
</p>

<p>
  <strong>Phone:</strong>
  <%= @organization.phone %>
</p>

<p>
  <strong>Dropoff Hours:</strong>
  <%= @organization.dropoff_hours %>
</p>  

<% else %>

<div class="description"><%= @organization.description %></div>

<div class="detail address">
  <%= link_to @address,
    "https://www.google.com/maps/dir/?api=1&destination=#{@address.to_param}",
    target: '_blank'
  %>
</div>

<% unless @organization.website.blank? %>
  <div class="detail website">
    <%= link_to @organization.website.sub(/^https?\:\/\/(www.)?/, ''),
      @organization.website,
      target: '_blank' %>
  </div>
<% end %>

<% unless @organization.phone.blank? %>
  <div class="detail phone">
    <%= @organization.phone %>
  </div>
<% end %>

<% unless @organization.email.blank? %>
  <div class="detail email">
    <%= @organization.email %>
  </div>
<% end %>

<% unless @organization.dropoff_hours.blank? %>
  <div class="detail hours">
    <%= @organization.dropoff_hours %>
  </div>
<% end %>
<% end %>

<% if current_admin || current_user %>

<%= link_to 'Edit', edit_organization_path(@organization) %> |
<%= link_to 'Back', organizations_path %>
<% else %>
<% end %>
<% if current_admin %>
| <%= link_to 'Delete Organization', @organization, method: :delete, data: { confirm: 'Are you sure you want to delete this organization?' } %>
<% end %>

<% if current_admin || current_user %>

<h2 class="needs">Current Needs</h2>
<div class="needs-list">
  <% @categories.each do |category| %>
    <h3 class="category"><%= category %></h3>
    <div class="needs-list row">
      <% Need.where(organization_id: @organization.id, category: category).each do |need| %>
        <div id="need-btn-<%= need.id %>" class="col-xs-12 col-md-6">         
          <% if need.enabled? %>
            <% url = need_disable_path(need) %>
            <% style = 'success' %>
          <% else %>
            <% url = need_enable_path(need) %>
            <% style = 'secondary' %>
          <% end %>
          <%= button_to need.item, url, method: :patch, remote: true,
            class: "btn btn-inline btn-#{style} mt-2" %>

          <% if need.enabled? %>
            <%= link_to edit_need_path(need),
              title: 'Add/edit comment',
              class: 'edit-need-link' do %>
              <%= open_iconic :icon, :comment_square %>
            <% end %>
          <% end %>
        </div>
          <% unless need.comment.blank? %>
            <div class="comment">
              <%= need.comment %>
            </div>
          <% end %>  
      <% end %>
    </div>  
  <% end%> 
  </div>     
  
<% else %>
<h2 class="needs">Current Needs</h2>
<div class="needs-list">
  <% @categories.each do |category| %>
    <h3 class="category"><%= category %></h3>
    <ul class="category">
      <% Need.where(organization_id: @organization.id, category: category, enabled: true).each do |need| %>
        <li class="need">
          <%= need.item %>
          <% unless need.comment.blank? %>
            <div class="comment">
              <%= need.comment %>
            </div>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>
<% end %>


